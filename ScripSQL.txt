drop database base_keveo2;
create database base_keveo2;
use base_keveo2;
CREATE  TABLE MENU(
    ID INTEGER auto_increment,
    ACTIVE INTEGER,
    DESCRIPTION VARCHAR(255) NOT NULL,
    APP_ORDER INTEGER,
    URL VARCHAR(255),
    PARENT_ID INTEGER,
    CONSTRAINT CONSTRAINT_2 PRIMARY KEY(ID)
);             
   
-- 6 +/- SELECT COUNT(*) FROM PUBLIC.MENU;    
INSERT INTO MENU VALUES
(1, 1, 'Home', 0, '/', NULL),
(2, 1, 'Gestion de Usuarios', 1, '/gestionUser', NULL),
(3, 1, 'Admin', 10, '/admin', NULL);
             
CREATE TABLE MENU_ROLES(
    MENU_ID INTEGER NOT NULL,
    ROLES_ID INTEGER NOT NULL
);              
ALTER TABLE MENU_ROLES ADD CONSTRAINT CONSTRAINT_4 PRIMARY KEY(MENU_ID, ROLES_ID);  
-- 11 +/- SELECT COUNT(*) FROM PUBLIC.MENU_ROLES;  

  INSERT INTO MENU_ROLES VALUES
(1, 1),
(1, 2),
(2, 1),
(3, 1);         
 
CREATE TABLE ROLE(
    ID INTEGER auto_increment,
    ROLE_NAME VARCHAR(255) NOT NULL,
    CONSTRAINT CONSTRAINT_26 PRIMARY KEY(ID)
);   
      
-- 2 +/- SELECT COUNT(*) FROM PUBLIC.ROLE;    
INSERT INTO ROLE VALUES
(1, 'ROLE_ADMIN'),
(2, 'ROLE_USER');     
        
CREATE  TABLE USER(
    ID INTEGER auto_increment,
    ACTIVE BOOLEAN,
    DATE DATE,
	REGISTER_DATE TIMESTAMP,
    PASSWORD VARCHAR(255) NOT NULL,
    USER_NAME VARCHAR(255) NOT NULL,
    USER_SURNAME VARCHAR(255),
    USER_EMAIL VARCHAR(255),
    UNIQUE (USER_EMAIL),
	CONSTRAINT CONSTRAINT_27E PRIMARY KEY(ID)
);          
INSERT INTO USER VALUES
(1, TRUE, '2022-05-08','2022-05-08T07:00:00', '$2a$04$5sT3dri6bOOG2b9P1LETEujUeYMR46G/OVybuBjxBAohlEtDsxmi2', 'admin',
'admin','admin@gmail.com'),
(2, FALSE, '2022-05-08','2022-05-08T07:00:00', '$2a$04$5sT3dri6bOOG2b9P1LETEujUeYMR46G/OVybuBjxBAohlEtDsxmi2', 'noactivo',
'noactivo','noactivo@gmail.com'),
(3, TRUE, '2022-05-08','2022-05-08T07:00:00', '$2a$04$5sT3dri6bOOG2b9P1LETEujUeYMR46G/OVybuBjxBAohlEtDsxmi2', 'esteban',
'torres','estebanto92@gmail.com')
;
-- 8 +/- SELECT COUNT(*) FROM PUBLIC.USER;    

CREATE TABLE USER_ROLES(
    USERS_ID INTEGER NOT NULL,
    ROLES_ID INTEGER NOT NULL
);             
ALTER TABLE USER_ROLES ADD CONSTRAINT CONSTRAINT_C PRIMARY KEY(USERS_ID, ROLES_ID); 
-- 9 +/- SELECT COUNT(*) FROM PUBLIC.USER_ROLES; 

INSERT INTO USER_ROLES VALUES
(1,1),
(1,2),
(3,2);
 
ALTER TABLE USER_ROLES ADD CONSTRAINT FKJ9553ASS9UCTJRMH0GKQSMV0D FOREIGN KEY(ROLES_ID) REFERENCES ROLE(ID) ;     
ALTER TABLE USER_ROLES ADD CONSTRAINT FK7ECYOBAA59VXKXCKG6T355L86 FOREIGN KEY(USERS_ID) REFERENCES USER(ID) ;     
ALTER TABLE MENU_ROLES ADD CONSTRAINT FKQ7K54HB6F3NGDBFPBLWJ68BHG FOREIGN KEY(MENU_ID) REFERENCES MENU(ID) ;      
ALTER TABLE MENU ADD CONSTRAINT FKGEUPUBDQNCC1LPGF2CN4FQWBC FOREIGN KEY(PARENT_ID) REFERENCES MENU(ID) ;          
ALTER TABLE MENU_ROLES ADD CONSTRAINT FKAUV6MBPEO296VHBM7AVTOI3O8 FOREIGN KEY(ROLES_ID) REFERENCES ROLE(ID) ;     
